# í¬íŒ… ë§¤ë‰´ì–¼

> ì•„ë˜ ì„¤ëª…ì€ ëª¨ë‘ EC2 ì„œë²„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë˜ì–´ìˆìŠµë‹ˆë‹¤.

<br><br>

## EC2 ê¸°ë³¸ ì„¤ì •

ì•„ë˜ ê³¼ì •ì€ UFWì´ í™œì„±í™”ë˜ì–´ ìˆë‹¤ëŠ” ì „ì œí•˜ì— ì§„í–‰ë©ë‹ˆë‹¤.

### 80 í¬íŠ¸ í—ˆìš©

1. UFW êµ¬ë™ëœ ìƒíƒœì—ì„œ 80 í¬íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
   ```sh
   sudo ufw allow 80
   ```
2. 80 í¬íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
   ```sh
   sudo ufw status numbered
   ```

<br>

### ì„œë²„ ì‹œê°„ëŒ€ ì„¤ì •

ì¶”í›„ ë””ë²„ê¹…í•  ë•Œ í¸ë¦¬í•˜ë„ë¡ ì„œë²„ ì‹œê°„ëŒ€ë¥¼ í•œêµ­ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

```sh
sudo timedatectl set-timezone Asia/Seoul
```

<br>

### ë¯¸ëŸ¬ ì‚¬ì´íŠ¸ ë³€ê²½

ê° ë¦¬ì „ì— ë§ëŠ” ë¯¸ëŸ¬ì‚¬ì´íŠ¸ë¥¼ ì„¤ì •í•˜ì—¬, ë” ë¹ ë¥´ê³  ì•ˆì •ì ìœ¼ë¡œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.

1. APT ì†ŒìŠ¤ ë¦¬ìŠ¤íŠ¸ íŒŒì¼ì„ ì—½ë‹ˆë‹¤.
   ```
   sodu vi /etc/apt/sources.list
   ```
2. ë¯¸ëŸ¬ ì‚¬ì´íŠ¸ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.
   ```
   :%s/{ê¸°ì¡´ë¯¸ëŸ¬ì„œë²„}/{ë³€ê²½í•  ë¯¸ëŸ¬ì„œë²„}
   ```
   í•œêµ­ì—ì„œëŠ” KAIST ë˜ëŠ” KAKAOë¥¼ ë§ì´ ì‚¬ìš©í•˜ë¯€ë¡œ ì•„ë˜ ë¯¸ëŸ¬ ì‚¬ì´íŠ¸ ì£¼ì†Œë¥¼ ì°¸ê³ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
   - KAIST: `ftp.kaist.ac.kr`
   - KAKAO: `mirror.kakao.com`

<br>

### ë¦¬ëˆ…ìŠ¤ ì—…ë°ì´íŠ¸ ë° í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜

1. ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì˜ íŒ¨í‚¤ì§€ ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•˜ê³ , ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ë¥¼ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•©ë‹ˆë‹¤.
   ```sh
   sudo apt update -y
   sudo apt upgrade -y
   ```
   â€» ìƒˆë¡œìš´ íŒ¨í‚¤ì§€ ë²„ì „ì˜ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ë‚˜ì„œ, í•´ë‹¹ ì •ë³´ë¥¼ í† ëŒ€ë¡œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•˜ë¯€ë¡œ ìœ„ì˜ ëª…ë ¹ì–´ ìˆœì„œë¥¼ ì¤€ìˆ˜í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
2. í•„ìˆ˜ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
   ```sh
   sudo apt-get install -y ca-certificates curl gnupg lsb-release
   ```

<br><br>

## Docker ì„¤ì¹˜ ë° ì„¤ì •

### Docker ì„¤ì¹˜

1. Dockerì˜ ê³µì‹ GPG í‚¤ë¥¼ ì¶”ê°€í•  ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
   ```sh
   sudo mkdir -p /etc/apt/keyrings
   ```
2. Dockerì˜ GPG í‚¤ ë‹¤ìš´ë¡œë“œí•œ í›„, ë°”ì´ë„ˆë¦¬ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.
   ```sh
   curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.png
   ```
3. Docker ì €ì¥ì†Œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
   ```sh
   echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
   ```
4. íŒ¨í‚¤ì§€ ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
   ```sh
   sudo apt-get update
   ```
5. Docker íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
   ```sh
   sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
   ```
6. Docker ë°ëª¬ì„ ì‹œì‘í•˜ê³  ë¶€íŒ… ì‹œ ìë™ìœ¼ë¡œ ì‹œì‘í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
   ```sh
   sudo systemctl start docker
   sudo systemctl enable docker
   ```

<br>

### Docker ì‹¤í–‰ ê¶Œí•œ ì„¤ì •

Docker ì‹¤í–‰ ê¶Œí•œì„ ì„¤ì •í•˜ì—¬, Docker ëª…ë ¹ì„ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ `sudo`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

1. í˜„ì¬ ì‚¬ìš©ìë¥¼ Docker ê·¸ë£¹ì— ì¶”ê°€í•œë‹¤.
   ```sh
   sudo usermode -aG docker $USER
   ```
   - í•´ë‹¹ ë³€ê²½ ì‚¬í•­ì€ ì¦‰ì‹œ ë°˜ì˜ë˜ì§€ ì•Šê³ , ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ìŒ ë¡œê·¸ì¸ì‹œ ì ìš©ë©ë‹ˆë‹¤.  
      âˆ´ ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒí•˜ê³  ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì•¼ ìƒˆë¡œ ì¶”ê°€ëœ ê·¸ë£¹ ê¶Œí•œì´ ì ìš©ë©ë‹ˆë‹¤.  
      ë”°ë¼ì„œ, ë¡œê·¸ì•„ì›ƒ/ë¡œê·¸ì¸ ì—†ì´ ì¦‰ì‹œ ì ìš©í•˜ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ í˜„ì¬ ì„¸ì…˜ì—ì„œ ê·¸ë£¹ ë³€ê²½ ì‚¬í•­ì„ ë°˜ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
     `   netgrp docker`
2. Docker ê·¸ë£¹ì— ì‚¬ìš©ìê°€ ì œëŒ€ë¡œ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
   ```sh
   groups $USER
   ```

<br>

### Docker Compose ì„¤ì •

1. Docker Compose ë²„ì „ì„ í™•ì¸í•©ë‹ˆë‹¤.
   ```sh
   docker-compose --version
   ```
   ë§Œì•½, `docker-compose` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ë‹¤ë©´ ë‹¤ìŒ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ Docker Composeë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
   ```sh
   sudo curl -L "https://github.com/docker/compose/releases/download/v2.6.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
   sudo chmod +x /usr/local/bin/docker-compose
   sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
   ```

<br><br>

## Nginx ë° certbot ì„¤ì •

### Nginx + certbot Docker Container ì •ì˜

certbotì„ ì´ìš©í•˜ì—¬ ë¬´ë£Œë¡œ SSL/TLS ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì€ í›„, Nginxì— SSL ì„¤ì •ì„ í•˜ì—¬ HTTPS í†µì‹ ì„ í•˜ë„ë¡ í•©ë‹ˆë‹¤.

1. Nginxì™€ certbot ê´€ë ¨ ì„¤ì • íŒŒì¼ì„ ì €ì¥í•  ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
   ```sh
   mkdir -p ~/newbie/data/nginx
   mkdir -p ~/newbie/data/certbot
   ```
2. `~/newbie/` ë””ë ‰í† ë¦¬ ì•ˆì— Nginxë‘ certbot ì»¨í…Œì´ë„ˆë¥¼ ì •ì˜í•  Docker Composeë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

   ```sh
   cd ~/newbie
   vi docker-compose.yml
   ```

   <docker-compose.yml>

   ```yml
   version: '3.8'

    services:
        nginx:
            image: nginx:latest
            restart: unless-stopped
            volumes:
                - ./data/nginx/nginx.conf:/etc/nginx/nginx.conf
                - ./data/certbot/conf:/etc/letsencrypt
                - ./data/certbot/www:/var/www/certbot
            ports:
                - "80:80"
                - "443:443"
            command: "/bin/sh -c 'while :; do sleep 320h & wait $${!}; nginx -s reload; done & nginx -g \"daemon off;\"'"
            environment:
                TZ: Asia/Seoul
            logging:
                options:
                    max-size: "10m"
                    max-file: "1"

        certbot:
            image: certbot/certbot
            restart: unless-stopped
            volumes:
                - ./data/certbot/conf:/etc/letsencrypt
                - ./data/certbot/www:/var/www/certbot
            entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 720h & wait $${!}; done;'"
            environment:
                TZ: Asia/Seoul
            logging:
                options:
                    max-size: "10m"
                    max-file: "1"
   ```

<br>

### Nginx ì„¤ì •

1. Nginx ì„¤ì •ì„ ì •ì˜í•©ë‹ˆë‹¤.

   ```sh
   cd ~/newbie/data/nginx
   vi nginx.conf
   ```

   <nginx.conf>

   ```conf
   user nginx;
   worker_processes 1;

   error_log /var/log/nginx/error.log warn;
   pid /var/run/nginx.pid;

   events {
      worker_connections 1024;
   }

   http {
      include /etc/nginx/mime.types;
      default_type application/octet-stream;

      log_format main '$remote_addr - $remote_user [$time_local] "$request"'
                     '$status $body_bytes_sent "$http_referer"'
                     '"$http_user_agent" "$http_x_forwarded_for"';

      access_log	/var/log/nginx/access.log main;

      sendfile on;
      keepalive_timeout 65;

      limit_req_zone $binary_remote_addr zone=mylimit:10m rate=1r/s;

      server {
         listen 80;

         server_name {DOMAIN NAME};
         server_tokens off;

         location /.well-known/acme-challenge/ {
         root /var/www/certbot;
         }

         location / {
               return 308 https://$host$request_uri;
         }
      }


      server {
         listen 443 ssl;

         server_name {DOMAIN NAME};
         server_tokens off;

         ssl_certificate /etc/letsencrypt/live/{DOMAIN NAME}/fullchain.pem;
         ssl_certificate_key /etc/letsencrypt/live/{DOMAIN NAME}/privkey.pem;

         include /etc/letsencrypt/options-ssl-nginx.conf;

         ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

         location / {
               limit_req zone=mylimit burst=1000 nodelay;

               proxy_set_header Host $host;
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
               proxy_set_header X-Forwarded-Proto $scheme;

               add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
               add_header Pragma "no-cache";
               add_header Expires "0";

               add_header 'Access-Control-Allow-Origin' '*';
               add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS';
               add_header 'Access-Control-Allow-Headers' 'Origin, Content-Type, Accept, Authorization';
               add_header 'Access-Control-Allow-Credentials' 'true';
         }
      }
   }
   ```

### SSL ì¸ì¦ì„œ ë°œê¸‰ ë° ì ìš©

1. SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

   ```sh
   cd ~/newbie
   vi init-letsencrypt.sh
   ```

   <init-letsencrypt.sh>

   ```sh
   #!/bin/bash

   # 1. check docker-compose installation
   if ! [ -x "$(command -v docker-compose)" ]; then
      echo 'Error: docker-compose is not installed.' >&2
      exit 1
   fi


   # 2. set domain, RSA key size, data path, email address, test mode
   domains=({DOMAIN NAME})
   rsa_key_size=4096
   data_path="./data/certbot"
   email=""
   staging=0


   # 3. check for existing data and ask the user if they want to overwrite it
   if [ -d "$data_path" ]; then
      read -p "Existing data found for $domains. Continue and replace existing certificate? (y/N)" decision
      if [ "$decision" != "Y" ] && [ "$decision" != "y" ]; then
         exit
      fi
   fi


   # 4. download recommended TSL configuration file
   if [ ! -e "$data_path/conf/options-ssl-nginx.conf" ] || [ ! -e "$data_path/conf/ssl-dhparams.pem" ]; then
      echo "### Downloading recommended TLS parameters ..."

      mkdir -p "$data_path/conf"

      curl -s https://raw.githubusercontent.com/certbot/certbot/master/certbot-nginx/certbot_nginx/_internal/tls_configs/options-ssl-nginx.conf > "$data_path/conf/options-ssl-nginx.conf"
      curl -s https://raw.githubusercontent.com/certbot/certbot/master/certbot/certbot/ssl-dhparams.pem > "$data_path/conf/ssl-dhparams.pem"

      echo
   fi


   # 5. create temporary dummy certificate
   echo "### Creating dummy certificate for $domains ..."

   path="/etc/letsencrypt/live/$domains"

   mkdir -p "$data_path/conf/live/$domains"

   docker-compose run --rm --entrypoint "\
      openssl req -x509 -nodes -newkey rsa:$rsa_key_size -days 1\
      -keyout '$path/privkey.pem' \
      -out '$path/fullchain.pem' \
      -subj '/CN=localhost'" certbot

   echo


   # 6. start nginx
   echo "### Starting nginx ..."

   docker-compose up --force-recreate -d nginx

   echo


   # 7. delete temporary dummy certificate
   echo "### Deleting dummy certificate for $domains ..."

   docker-compose run --rm --entrypoint "\
      rm -Rf /etc/letsencrypt/live/$domains && \
      rm -Rf /etc/letsencrypt/archive/$domains && \
      rm -Rf /etc/letsencrypt/renewal/$domains.conf" certbot

   echo


   # 8. Request Let's Encrypt certificate
   echo "### Requesting Let's Encrypt certificate for $domains ..."

   # 8-1. set domain arguments
   domain_args=""
   for domain in "${domains[@]}"; do
      domain_args="$domain_args -d $domain"
   done

   # 8-2. set email arguments
   email_arg="--register-unsafely-without-email"
   if [ -n "$email" ]; then
      email_arg="--email $email"
   fi

   # 8-3. set staging arguments
   staging_arg=""
   if [ $staging -ne 0 ]; then
      staging_arg="--staging"
   fi

   docker-compose run --rm --entrypoint "\
      certbot certonly --webroot \
      -w /var/www/certbot \
      $staging_arg \
      $email_arg \
      $domain_args \
      --rsa-key-size $rsa_key_size \
      --agree-tos \
      --force-renewal" certbot

   echo


   # 9. reload nginx
   echo "### Reloading nginx ..."
   docker-compose exec nginx nginx -s reload
   ```

2. ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì— ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•˜ê³  ì‹¤í–‰í•˜ì—¬ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.
   ```sh
   chmod +x init-letsencrypt.sh
   ./init-letsencrypt.sh
   ```

<br><br>

## NEWBIE í”„ë¡œì íŠ¸ ë°°í¬

NEWBIE í”„ë¡œì íŠ¸ëŠ” React 1 + Spring Cloud Gateway 1 + Spring Boot 9 + FastAPI 1 + RabbitMQ 1 + Redis 3 + MySQL 4 + + MongoDB 3ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆìœ¼ë©°, í•´ë‹¹ í”„ë¡œê·¸ë¨ì„ ëª¨ë‘ ì‹¤í–‰í•´ì•¼ ì •ìƒì ìœ¼ë¡œ ì‘ë™ë©ë‹ˆë‹¤.  
ì•„ë˜ ë‚´ìš©ì€ í•´ë‹¹ git í”„ë¡œì íŠ¸ë¥¼ clone ë°›ì•˜ë‹¤ëŠ” ì „ì œí•˜ì— ì§„í–‰ë©ë‹ˆë‹¤. ğŸ˜‰  
(ì°¸ê³ ë¡œ, `~/newbie` ë°‘ì— git í”„ë¡œì íŠ¸ë¥¼ clone ë°›ì•˜ë‹¤ ê°€ì •í•˜ê³  ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.)

<br>

**PACKAGE VERSION**  
Package Name | Version
--- | ---
docker | 27.3.1
node.js | 20.18.0
java | openjdk-17.0.11

<br>

**PORT**  
Project Name | Docker Container Name | Port
--- | --- | ---
React | frontend | 3000
Jenkins | jenkins | 8080
Spring Cloud Gateway | backend-gateway | 8080
Spring Boot for Authentication | backend-auth | 8080
Spring Boot for User | backend-auth | 8080
Spring Boot for Mypage | backend-mypage | 8080
Spring Boot for Baseball | backend-baseball | 8080
Spring Boot for Chatting with User | backend-chat | 8080
Spring Boot for Chatbot with Baseball Dictionary | backend-chatbot | 8080
Spring Boot for Photo Card Store | backend-cardstore | 8080
Spring Boot for Board | backend-board | 8080
Spirng Boot for Mileage | backend-mileage | 8080
FastAPI for Club Recommendation | backend-club-recommend | 8080
RabbitMQ | rabbitmq | 4369, 5671-5672
Redis for Baseball | redis-baseball | 6379
Redis for Chatting with User | redis-chat | 6379
Redis for Chatbot with Baseball Dictionary | redis-chatbot | 6379
MySQL for Authentication | mysql-auth | 3306
MySQL for User | mysql-user | 3306
MySQL for Baseball | mysql-baseball | 3306
MySQL for Board | mysql-board | 3306
MongoDB for Mypage | mongodb-mypage | 27017
MongoDB for Photo Card Store | mongodb-cardstore | 27017
MongoDB for Mileage | mongodb-mileage | 27017

<br>

### í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬

1. í”„ë¡œì íŠ¸ì™€ ê´€ë ¨ëœ í™˜ê²½ë³€ìˆ˜ë¥¼ ê´€ë¦¬í•˜ëŠ” íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

   ```sh
   cd ~/newbie
   vi .env
   ```

   <.env>

   ```env
   # <BE>
    SERVER_DOMAIN=https://{DOMAIN_NAME}


    # server
    SERVER_PATH=8080/api/v1

    AUTH_SERVER_DOMAIN=http://backend-auth
    USER_SERVER_DOMAIN=http://backend-user
    MYPAGE_SERVER_DOMAIN=http://backend-mypage
    BASEBALL_SERVER_DOMAIN=http://backend-baseball
    CHAT_SERVER_DOMAIN=http://backend-chat
    CHATBOT_SERVER_DOMAIN=http://backend-chatbot
    CARDSTORE_SERVER_DOMAIN=http://backend-cardstore
    BOARD_SERVER_DOMAIN=http://backend-board

    CLUB_RECOMMEND_SERVER_DOMAIN=http://backend-club-recommend
    MILAGE_SERVER_DOMAIN=http://backend-mileage


    # swagger
    CARDSTORE_API_DOCS_PATH=/v3/api-docs


    # MySQL
    MYSQL_DDL_AUTO=update
    MYSQL_USERNAME={MYSQL_USERNAME}

    AUTH_MYSQL_URL=jdbc:mysql://mysql-auth:3306/auth
    AUTH_MYSQL_PASSWORD={AUTH_MYSQL_PASSWORD}

    USER_MYSQL_URL=jdbc:mysql://mysql-user:3306/user
    USER_MYSQL_PASSWORD={USER_MYSQL_PASSWORD}

    BASEBALL_MYSQL_URL=jdbc:mysql://mysql-baseball:3306/baseball
    BASEBALL_MYSQL_PASSWORD={BASEBALL_MYSQL_PASSWORD}

    BOARD_MYSQL_URL=jdbc:mysql://mysql-board:3306/board
    BOARD_MYSQL_PASSWORD={BOARD_MYSQL_PASSWORD}


    # mongoDB
    MONGODB_USERNAME={MONGODB_USERNAME}

    MYPAGE_MONGODB_HOST=mongodb-mypage
    MYPAGE_MONGODB_PORT=27017
    MYPAGE_MONGODB_DATABASE=mypage
    MYPAGE_MONGODB_PASSWORD={MYPAGE_MONGODB_PASSWORD}

    CARDSTORE_MONGODB_HOST=mongodb-cardstore
    CARDSTORE_MONGODB_PORT=27017
    CARDSTORE_MONGODB_DATABASE=cardstore
    CARDSTORE_MONGODB_PASSWORD={CARDSTORE_MONGODB_PASSWORD}

    MILEAGE_MONGODB_HOST=mongodb-mileage
    MILEAGE_MONGODB_PORT=27017
    MILEAGE_MONGODB_DATABASE=mileage
    MILEAGE_MONGODB_PASSWORD={MILEAGE_MONGODB_PASSWORD}


    # redis
    BASEBALL_REDIS_HOST=redis-baseball
    BASEBALL_REDIS_PORT=6379
    BASEBALL_REDIS_TIME=600000

    CHAT_REDIS_HOST=redis-chat
    CHAT_REDIS_PORT=6379

    CHATBOT_REDIS_HOST=redis-chatbot
    CHATBOT_REDIS_PORT=6379


    # rabbitMQ
    RABBITMQ_HOST=rabbitmq
    RABBITMQ_PORT=5672
    RABBITMQ_USERNAME={RABBITMQ_USERNAME}
    RABBITMQ_PASSWORD={RABBITMQ_PASSWORD}

    RABBITMQ_CLUB_RECOMMEND_QUEUE_NAME=club-recommend-queue
    RABBITMQ_CLUB_RECOMMEND_EXCHANGE_NAME=club-recommend-exchange
    RABBITMQ_CLUB_RECOMMEND_ROUTING_KEY=club-recommend

    RABBITMQ_PLAYER_QUEUE_NAME=player-queue
    RABBITMQ_PLAYER_ROUTING_KEY=player

    RABBITMQ_AUTH_BOARD_QUEUE_NAME=auth-board-queue
    RABBITMQ_AUTH_BOARD_EXCHANGE_NAME=auth-board-exchange
    RABBITMQ_AUTH_BOARD_ROUTING_KEY=auth-board

    RABBITMQ_BOARD_MILEAGE_QUEUE_NAME=mileage-board-queue
    RABBITMQ_BOARD_MILEAGE_ROUTING_KEY=mileage-board

    RABBITMQ_MILEAGE_QUEUE_NAME=mileage-queue
    RABBITMQ_MILEAGE_EXCHANGE_NAME=mileage-exchange
    RABBITMQ_MILEAGE_ROUTING_KEY=mileage


    # JWT
    JWT={JWT_SECRET_KEY}


    # KAKAO
    KAKAO_CLIENT_ID={KAKAO_CLIENT_ID}
    KAKAO_GRANT_TYPE={KAKAO_GRANT_TYPE}
    KAKAO_REDIRECT_URI=https://{DOMAIN_NAME}/auth/redirect?platform=kakao
    KAKAO_RESTAPI={KAKAO_CLIENT_SECRET}


    # NAVER OCR
    NAVER_OCR_API_KEY={NAVER_OCR_API_KEY}
    NAVER_OCR_API_URL={NAVER_OCR_API_URL}


    # YouTube API
    YOUTUBE_API_KEY={YOUTUBE_API_KEY}


    # AWS S3
    HO_AWS_ACCESS_KEY={AWS_ACCESS_KEY_1}
    HO_AWS_SECRET_KEY={AWS_SECRET_KEY_1}
    HO_AWS_S3_BUCKET={AWS_SECRET_S3_BUCKET_1}

    HA_AWS_ACCESS_KEY={AWS_ACCESS_KEY_2}
    HA_AWS_SECRET_KEY={AWS_SECRET_KEY_2}
    HA_AWS_S3_BUCKET={AWS_SECRET_S3_BUCKET_2}
    HA_AWS_BOARD_FOLDER={AWS_BOARD_FOLDER_NAME}
    HA_AWS_REGION={AWS_REGION}


    # OPENAI API KEY
    OPENAI_API_KEY={OPENAI_API_KEY}


    # FRONT-END
    VITE_API_BASE_URL=https://{DOMAIN_NAME}
    VITE_API_SOCKET_URL=wss://{DOMAIN_NAME}

    VITE_WEATHER_DATA_API_KEY={WEATHER_DATA_API_KEY}
    VITE_GET_WEATHER_URL=https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getUltraSrtFcst

   ```

   - ìœ„ì˜ ìƒí™©ì€ AWS S3ë¥¼ 2ê°œ ì‚¬ìš©í•˜ì˜€ì§€ë§Œ, ìƒí™©ì— ë”°ë¼ 1ê°œë§Œ ì‚¬ìš©í•˜ì…”ë„ ê´œì°®ìŠµë‹ˆë‹¤.
   - NAVER OCR, YouTube API, OpenAI API, ê¸°ìƒì²­ ë‹¨ê¸°ì˜ˆë³´(Weather Data API)ëŠ” ë‹¤ìŒ ì•„ë˜ ì‚¬ì´íŠ¸ë¥¼ ì°¸ê³ í•˜ì…”ì„œ APIë¥¼ ì‹ ì²­ í›„ ê´€ë ¨ëœ ë³€ìˆ˜ë¥¼ ë„£ìœ¼ì‹œë©´ ë©ë‹ˆë‹¤.
     - NAVER OCR: https://www.ncloud.com/product/aiService/ocr
     - YouTube API: https://developers.google.com/youtube/v3?hl=ko
     - OpenAI: https://openai.com
     - ê¸°ìƒì²­ ë‹¨ê¸°ì˜ˆë³´: https://www.data.go.kr/iim/api/selectAPIAcountView.do

<br>

### React(Front-End) Docker Image ìƒì„±

1. React í”„ë¡œì íŠ¸ì˜ ìµœìƒìœ„ í´ë”ë¡œ ì´ë™í•©ë‹ˆë‹¤.
   ```sh
   cd ~/newbie/S11P21B303/frontend
   ```
2. React í”„ë¡œì íŠ¸ë¥¼ npmì„ ì‚¬ìš©í•˜ì—¬ í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œ í›„ ë¹Œë“œí•©ë‹ˆë‹¤.
   ```sh
   npm install & npm run build
   ```
3. ë¹Œë“œëœ ê²°ê³¼ë¬¼ì„ í† ëŒ€ë¡œ React Docker Imageë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
   ```sh
   docker build -t frontend:latest -f ./Dockerfile .
   ```

<br>

### Spring Boot(Backe-End) Docker Image ìƒì„±

Spring Boot for Authentication í”„ë¡œì íŠ¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ Docker Imageë¥¼ ìƒì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.  
ë‹¤ë¥¸ Spring Cloud Gateway ë° Spring Boot í”„ë¡œì íŠ¸ë„ ë™ì¼í•˜ê²Œ ì§„í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

1. Spring Boot for Authentication í”„ë¡œì íŠ¸ì˜ ìµœìƒìœ„ í´ë”ë¡œ ì´ë™í•©ë‹ˆë‹¤.
   ```sh
   cd ~/newbie/S11P21B303/backend/auth
   ```
2. Spring Boot í”„ë¡œì íŠ¸ë¥´ gradleì„ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ ë° ë¹Œë“œí•©ë‹ˆë‹¤.
   ```sh
   ./gradlew clean build --no-daemon
   ```
3. ë¹Œë“œëœ ê²°ê³¼ë¬¼ì„ í† ëŒ€ë¡œ Spring Boot for Authentication Docker Imageë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
   ```sh
   docker build -t backend-auth:latest -f ./Dockerfile .
   ```

<br>

### NEWBIE í”„ë¡œì íŠ¸ Docker Container ìƒì„± ë° ì‹¤í–‰

1. NEWBIE í”„ë¡œì íŠ¸ì™€ ê´€ë ¨ëœ Docker Containerë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œ ì•ì„œ ìƒì„±í•œ Docker Composeë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.

   ```sh
   cd ~/dontouch
   vi docker-compose.yml
   ```

   <docker-compose.yml>

   ```yml
   services:
     nginx:
       image: nginx:latest
       restart: unless-stopped
       volumes:
         - ./data/nginx/nginx.conf:/etc/nginx/nginx.conf
         - ./data/certbot/conf:/etc/letsencrypt
         - ./data/certbot/www:/var/www/certbot
       ports:
         - "80:80"
         - "443:443"
       command: '/bin/sh -c ''while :; do sleep 320h & wait $${!}; nginx -s reload; done & nginx -g "daemon off;"'''
       environment:
         TZ: Asia/Seoul
       logging:
         driver: "json-file"
         options:
           max-size: "10m"
           max-file: "1"

     certbot:
       image: certbot/certbot
       restart: unless-stopped
       volumes:
         - ./data/certbot/conf:/etc/letsencrypt
         - ./data/certbot/www:/var/www/certbot
       entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 720h & wait $${!}; done;'"
       environment:
         TZ: Asia/Seoul
       logging:
         driver: "json-file"
         options:
           max-size: "10m"
           max-file: "1"

     jenkins:
       build:
         context: ./data/jenkins/.
         dockerfile: Dockerfile
       restart: unless-stopped
       volumes:
         - jenkins_home:/var/jenkins_home
         - ./data/jenkins:/var/jenkins_shared
         - /var/run/docker.sock:/var/run/docker.sock
         - /usr/local/bin/docker-compose:/usr/local/bin/docker-compose
         - /usr/bin/docker:/usr/bin/docker
         - /home/ubuntu/newbie:/home/ubuntu/newbie
       environment:
         TZ: Asia/Seoul
         JENKINS_OPTS: --prefix=/jenkins
         # server
         AUTH_SERVER_URL: ${SERVER_DOMAIN}/api-auth
         USER_SERVER_URL: ${SERVER_DOMAIN}/api-user
         MYPAGE_SERVER_URL: ${SERVER_DOMAIN}/api-mypage
         BASEBALL_SERVER_URL: ${SERVER_DOMAIN}/api-baseball
         CHATBOT_SERVER_URL: ${SERVER_DOMAIN}/api-chatbot
         CARDSTORE_SERVER_URL: ${SERVER_DOMAIN}/api-cardstore
         BOARD_SERVER_URL: ${SERVER_DOMAIN}/api-board
         SERVER_PATH: ${SERVER_PATH}
         AUTH_SERVER_DOMAIN: ${AUTH_SERVER_DOMAIN}:8080
         USER_SERVER_DOMAIN: ${USER_SERVER_DOMAIN}:8080
         MYPAGE_SERVER_DOMAIN: ${MYPAGE_SERVER_DOMAIN}:8080
         BASEBALL_SERVER_DOMAIN: ${BASEBALL_SERVER_DOMAIN}:8080
         CHAT_SERVER_DOMAIN: ${CHAT_SERVER_DOMAIN}:8080
         CHATBOT_SERVER_DOMAIN: ${CHATBOT_SERVER_DOMAIN}:8080
         CARDSTORE_SERVER_DOMAIN: ${CARDSTORE_SERVER_DOMAIN}:8080
         BOARD_SERVER_DOMAIN: ${BOARD_SERVER_DOMAIN}:8080
         CLUB_RECOMMEND_SERVER_DOMAIN: ${CLUB_RECOMMEND_SERVER_DOMAIN}:8000/recommend
         MILAGE_SERVER_DOMAIN: ${MILAGE_SERVER_DOMAIN}:8080
         # swagger
         CARDSTORE_API_DOCS_PATH: ${CARDSTORE_API_DOCS_PATH}
         # MySQL
         MYSQL_DDL_AUTO: ${MYSQL_DDL_AUTO}
         MYSQL_USERNAME: ${MYSQL_USERNAME}
         AUTH_MYSQL_URL: ${AUTH_MYSQL_URL}
         AUTH_MYSQL_PASSWORD: ${AUTH_MYSQL_PASSWORD}
         USER_MYSQL_URL: ${USER_MYSQL_URL}
         USER_MYSQL_PASSWORD: ${USER_MYSQL_PASSWORD}
         BASEBALL_MYSQL_URL: ${BASEBALL_MYSQL_URL}
         BASEBALL_MYSQL_PASSWORD: ${BASEBALL_MYSQL_PASSWORD}
         BOARD_MYSQL_URL: ${BOARD_MYSQL_URL}
         BOARD_MYSQL_PASSWORD: ${BOARD_MYSQL_PASSWORD}
         # mongoDB
         MONGODB_USERNAME: ${MONGODB_USERNAME}
         MYPAGE_MONGODB_HOST: ${MYPAGE_MONGODB_HOST}
         MYPAGE_MONGODB_PORT: ${MYPAGE_MONGODB_PORT}
         MYPAGE_MONGODB_DATABASE: ${MYPAGE_MONGODB_DATABASE}
         MYPAGE_MONGODB_PASSWORD: ${MYPAGE_MONGODB_PASSWORD}
         CARDSTORE_MONGODB_HOST: ${CARDSTORE_MONGODB_HOST}
         CARDSTORE_MONGODB_PORT: ${CARDSTORE_MONGODB_PORT}
         CARDSTORE_MONGODB_DATABASE: ${CARDSTORE_MONGODB_DATABASE}
         CARDSTORE_MONGODB_PASSWORD: ${CARDSTORE_MONGODB_PASSWORD}
         MILEAGE_MONGODB_HOST: ${MILEAGE_MONGODB_HOST}
         MILEAGE_MONGODB_PORT: ${MILEAGE_MONGODB_PORT}
         MILEAGE_MONGODB_DATABASE: ${MILEAGE_MONGODB_DATABASE}
         MILEAGE_MONGODB_PASSWORD: ${MILEAGE_MONGODB_PASSWORD}
         # redis
         BASEBALL_REDIS_HOST: ${BASEBALL_REDIS_HOST}
         BASEBALL_REDIS_PORT: ${BASEBALL_REDIS_PORT}
         BASEBALL_REDIS_TIME: ${BASEBALL_REDIS_TIME}
         CHAT_REDIS_HOST: ${CHAT_REDIS_HOST}
         CHAT_REDIS_PORT: ${CHAT_REDIS_PORT}
         CHATBOT_REDIS_HOST: ${CHATBOT_REDIS_HOST}
         CHATBOT_REDIS_PORT: ${CHATBOT_REDIS_PORT}
         # rabbitMQ
         RABBITMQ_HOST: ${RABBITMQ_HOST}
         RABBITMQ_PORT: ${RABBITMQ_PORT}
         RABBITMQ_USERNAME: ${RABBITMQ_USERNAME}
         RABBITMQ_PASSWORD: ${RABBITMQ_PASSWORD}
         RABBITMQ_CLUB_RECOMMEND_QUEUE_NAME: ${RABBITMQ_CLUB_RECOMMEND_QUEUE_NAME}
         RABBITMQ_CLUB_RECOMMEND_EXCHANGE_NAME: ${RABBITMQ_CLUB_RECOMMEND_EXCHANGE_NAME}
         RABBITMQ_CLUB_RECOMMEND_ROUTING_KEY: ${RABBITMQ_CLUB_RECOMMEND_ROUTING_KEY}
         RABBITMQ_PLAYER_QUEUE_NAME: ${RABBITMQ_PLAYER_QUEUE_NAME}
         RABBITMQ_PLAYER_ROUTING_KEY: ${RABBITMQ_PLAYER_ROUTING_KEY}
         RABBITMQ_MILEAGE_QUEUE_NAME: ${RABBITMQ_MILEAGE_QUEUE_NAME}
         RABBITMQ_MILEAGE_EXCHANGE_NAME: ${RABBITMQ_MILEAGE_EXCHANGE_NAME}
         RABBITMQ_MILEAGE_ROUTING_KEY: ${RABBITMQ_MILEAGE_ROUTING_KEY}
         RABBITMQ_BOARD_MILEAGE_QUEUE_NAME: ${RABBITMQ_BOARD_MILEAGE_QUEUE_NAME}
         RABBITMQ_BOARD_MILEAGE_ROUTING_KEY: ${RABBITMQ_BOARD_MILEAGE_ROUTING_KEY}
         RABBITMQ_AUTH_BOARD_QUEUE_NAME: ${RABBITMQ_AUTH_BOARD_QUEUE_NAME}
         RABBITMQ_AUTH_BOARD_EXCHANGE_NAME: ${RABBITMQ_AUTH_BOARD_EXCHANGE_NAME}
         RABBITMQ_AUTH_BOARD_ROUTING_KEY: ${RABBITMQ_AUTH_BOARD_ROUTING_KEY}
         # JWT
         JWT: ${JWT}
         # KAKAO
         KAKAO_CLIENT_ID: ${KAKAO_CLIENT_ID}
         KAKAO_GRANT_TYPE: ${KAKAO_GRANT_TYPE}
         KAKAO_REDIRECT_URI: ${KAKAO_REDIRECT_URI}
         KAKAO_RESTAPI: ${KAKAO_RESTAPI}
         # NAVER OCR
         NAVER_OCR_API_URL: ${NAVER_OCR_API_URL}
         NAVER_OCR_API_KEY: ${NAVER_OCR_API_KEY}
         # YouTube API
         YOUTUBE_API_KEY: ${YOUTUBE_API_KEY}
         # AWS S3
         HO_AWS_ACCESS_KEY: ${HO_AWS_ACCESS_KEY}
         HO_AWS_SECRET_KEY: ${HO_AWS_SECRET_KEY}
         HO_AWS_S3_BUCKET: ${HO_AWS_S3_BUCKET}
         HA_AWS_ACCESS_KEY: ${HA_AWS_ACCESS_KEY}
         HA_AWS_SECRET_KEY: ${HA_AWS_SECRET_KEY}
         HA_AWS_S3_BUCKET: ${HA_AWS_S3_BUCKET}
         HA_AWS_REGION: ${HA_AWS_REGION}
         HA_AWS_BOARD_FOLDER: ${HA_AWS_BOARD_FOLDER}
         # OPENAPI API KEY
         OPENAI_API_KEY: ${OPENAI_API_KEY}
         # FRONTEND
         VITE_API_BASE_URL: ${VITE_API_BASE_URL}
         VITE_API_SOCKET_URL: ${VITE_API_SOCKET_URL}
         VITE_KAKAO_REST_API: ${KAKAO_RESTAPI}
         VITE_KAKAO_REDIRECT_URI: ${KAKAO_REDIRECT_URI}
         VITE_WEATHER_DATA_API_KEY: ${VITE_WEATHER_DATA_API_KEY}
         VITE_GET_WEATHER_URL: ${VITE_GET_WEATHER_URL}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     rabbitmq:
       image: rabbitmq:3-management
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         RABBITMQ_DEFAULT_USER: ${RABBITMQ_USERNAME}
         RABBITMQ_DEFAULT_PASS: ${RABBITMQ_PASSWORD}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     redis-baseball:
       image: redis
       restart: unless-stopped
       volumes:
         - ./data/redis/baseball:/data
       environment:
         TZ: Asia/Seoul
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     redis-chat:
       image: redis
       restart: unless-stopped
       volumes:
         - ./data/redis/chat:/data
       environment:
         TZ: Asia/Seoul
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     redis-chatbot:
       image: redis
       restart: unless-stopped
       volumes:
         - ./data/redis/chatbot:/data
       environment:
         TZ: Asia/Seoul
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     mysql-auth:
       image: mysql
       restart: unless-stopped
       volumes:
         - ./data/mysql/auth:/var/lib/mysql
       environment:
         TZ: Asia/Seoul
         MYSQL_ROOT_PASSWORD: { AUTH_MYSQL_ROOT_PASSWORD }
         MYSQL_DATABASE: auth
         MYSQL_USER: ${MYSQL_USERNAME}
         MYSQL_PASSWORD: ${AUTH_MYSQL_PASSWORD}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     mysql-user:
       image: mysql
       restart: unless-stopped
       volumes:
         - ./data/mysql/user:/var/lib/mysql
       environment:
         TZ: Asia/Seoul
         MYSQL_ROOT_PASSWORD: { USER_MYSQL_ROOT_PASSWORD }
         MYSQL_DATABASE: user
         MYSQL_USER: ${MYSQL_USERNAME}
         MYSQL_PASSWORD: ${USER_MYSQL_PASSWORD}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     mysql-baseball:
       image: mysql
       restart: unless-stopped
       volumes:
         - ./data/mysql/baseball:/var/lib/mysql
       environment:
         TZ: Asia/Seoul
         MYSQL_ROOT_PASSWORD: { BASEBALL_MYSQL_ROOT_PASSWORD }
         MYSQL_DATABASE: baseball
         MYSQL_USER: ${MYSQL_USERNAME}
         MYSQL_PASSWORD: ${BASEBALL_MYSQL_PASSWORD}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     mysql-board:
       image: mysql
       restart: unless-stopped
       volumes:
         - ./data/mysql/board:/var/lib/mysql
       environment:
         TZ: Asia/Seoul
         MYSQL_ROOT_PASSWORD: { BOARD_MYSQL_ROOT_PASSWORD }
         MYSQL_DATABASE: board
         MYSQL_USER: ${MYSQL_USERNAME}
         MYSQL_PASSWORD: ${BOARD_MYSQL_PASSWORD}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     mongodb-mypage:
       image: mongo
       restart: unless-stopped
       volumes:
         - ./data/mongodb/mypage:/data/db
       environment:
         TZ: Asia/Seoul
         MONGO_INITDB_ROOT_USERNAME: { MONGODB_USERNAME }
         MONGO_INITDB_ROOT_PASSWORD: { MYPAGE_MONGODB_PASSWORD }
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     mongodb-cardstore:
       image: mongo
       restart: unless-stopped
       ports:
         - "27017:27017"
       volumes:
         - ./data/mongodb/cardstore:/data/db
       environment:
         TZ: Asia/Seoul
         MONGO_INITDB_ROOT_USERNAME: { MONGODB_USERNAME }
         MONGO_INITDB_ROOT_PASSWORD: { CARDSTORE_MONGODB_PASSWORD }
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     mongodb-mileage:
       image: mongo
       restart: unless-stopped
       volumes:
         - ./data/mongodb/mileage:/data/db
       environment:
         TZ: Asia/Seoul
         MONGO_INITDB_ROOT_USERNAME: { MONGODB_USERNAME }
         MONGO_INITDB_ROOT_PASSWORD: { MILEAGE_MONGODB_PASSWORD }
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     frontend:
       image: frontend:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         MODE_ENV: production
         VITE_API_BASE_URL: ${VITE_API_BASE_URL}
         VITE_API_SOCKET_URL: ${VITE_API_SOCKET_URL}
         VITE_KAKAO_REST_API: ${KAKAO_RESTAPI}
         VITE_KAKAO_REDIRECT_URI: ${KAKAO_REDIRECT_URI}
         VITE_WEATHER_DATA_API_KEY: ${VITE_WEATHER_DATA_API_KEY}
         VITE_GET_WEATHER_URL: ${VITE_GET_WEATHER_URL}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-gateway:
       image: backend-gateway:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         # server
         AUTH_SERVER_DOMAIN: ${AUTH_SERVER_DOMAIN}:8080
         USER_SERVER_DOMAIN: ${USER_SERVER_DOMAIN}:8080
         MYPAGE_SERVER_DOMAIN: ${MYPAGE_SERVER_DOMAIN}:8080
         BASEBALL_SERVER_DOMAIN: ${BASEBALL_SERVER_DOMAIN}:8080
         CHAT_SERVER_DOMAIN: ${CHAT_SERVER_DOMAIN}:8080
         CHATBOT_SERVER_DOMAIN: ${CHATBOT_SERVER_DOMAIN}:8080
         CARDSTORE_SERVER_DOMAIN: ${CARDSTORE_SERVER_DOMAIN}:8080
         BOARD_SERVER_DOMAIN: ${BOARD_SERVER_DOMAIN}:8080
         # JWT
         JWT: ${JWT}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-auth:
       image: backend-auth:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         # server
         AUTH_SERVER_URL: ${SERVER_DOMAIN}/api-auth
         USER_SERVER_DOMAIN: ${USER_SERVER_DOMAIN}:8080
         # JWT
         JWT: ${JWT}
         # rabbitMQ
         RABBITMQ_HOST: ${RABBITMQ_HOST}
         RABBITMQ_PORT: ${RABBITMQ_PORT}
         RABBITMQ_USERNAME: ${RABBITMQ_USERNAME}
         RABBITMQ_PASSWORD: ${RABBITMQ_PASSWORD}
         RABBITMQ_AUTH_BOARD_QUEUE_NAME: ${RABBITMQ_AUTH_BOARD_QUEUE_NAME}
         RABBITMQ_AUTH_BOARD_EXCHANGE_NAME: ${RABBITMQ_AUTH_BOARD_EXCHANGE_NAME}
         RABBITMQ_AUTH_BOARD_ROUTING_KEY: ${RABBITMQ_AUTH_BOARD_ROUTING_KEY}
         # MySQL
         AUTH_MYSQL_URL: ${AUTH_MYSQL_URL}
         MYSQL_USERNAME: ${MYSQL_USERNAME}
         AUTH_MYSQL_PASSWORD: ${AUTH_MYSQL_PASSWORD}
         # KAKAO
         KAKAO_CLIENT_ID: ${KAKAO_CLIENT_ID}
         KAKAO_GRANT_TYPE: ${KAKAO_GRANT_TYPE}
         KAKAO_REDIRECT_URI: ${KAKAO_REDIRECT_URI}
         KAKAO_RESTAPI: ${KAKAO_RESTAPI}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-user:
       image: backend-user:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         # server
         USER_SERVER_URL: ${SERVER_DOMAIN}/api-user
         # MySQL
         MYSQL_DDL_AUTO: ${MYSQL_DDL_AUTO}
         USER_MYSQL_URL: ${USER_MYSQL_URL}
         MYSQL_USERNAME: ${MYSQL_USERNAME}
         USER_MYSQL_PASSWORD: ${USER_MYSQL_PASSWORD}
         # AWS S3
         HO_AWS_ACCESS_KEY: ${HO_AWS_ACCESS_KEY}
         HO_AWS_SECRET_KEY: ${HO_AWS_SECRET_KEY}
         HO_AWS_S3_BUCKET: ${HO_AWS_S3_BUCKET}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-mypage:
       image: backend-mypage:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         # server
         MYPAGE_SERVER_URL: ${SERVER_DOMAIN}/api-mypage
         CLUB_RECOMMEND_SERVER_DOMAIN: ${CLUB_RECOMMEND_SERVER_DOMAIN}:8000/recommend
         # mongoDB
         MONGODB_USERNAME: ${MONGODB_USERNAME}
         MYPAGE_MONGODB_HOST: ${MYPAGE_MONGODB_HOST}
         MYPAGE_MONGODB_PORT: ${MYPAGE_MONGODB_PORT}
         MYPAGE_MONGODB_DATABASE: ${MYPAGE_MONGODB_DATABASE}
         MYPAGE_MONGODB_PASSWORD: ${MYPAGE_MONGODB_PASSWORD}
         # rabbitMQ
         RABBITMQ_HOST: ${RABBITMQ_HOST}
         RABBITMQ_PORT: ${RABBITMQ_PORT}
         RABBITMQ_USERNAME: ${RABBITMQ_USERNAME}
         RABBITMQ_PASSWORD: ${RABBITMQ_PASSWORD}
         RABBITMQ_CLUB_RECOMMEND_QUEUE_NAME: ${RABBITMQ_CLUB_RECOMMEND_QUEUE_NAME}
         RABBITMQ_CLUB_RECOMMEND_EXCHANGE_NAME: ${RABBITMQ_CLUB_RECOMMEND_EXCHANGE_NAME}
         RABBITMQ_CLUB_RECOMMEND_ROUTING_KEY: ${RABBITMQ_CLUB_RECOMMEND_ROUTING_KEY}
         # NAVER OCR
         NAVER_OCR_API_URL: ${NAVER_OCR_API_URL}
         NAVER_OCR_API_KEY: ${NAVER_OCR_API_KEY}
         # AWS S3
         HA_AWS_ACCESS_KEY: ${HA_AWS_ACCESS_KEY}
         HA_AWS_SECRET_KEY: ${HA_AWS_SECRET_KEY}
         HA_AWS_S3_BUCKET: ${HA_AWS_S3_BUCKET}
         HA_AWS_REGION: ${HA_AWS_REGION}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-baseball:
       image: backend-baseball:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         # server
         BASEBALL_SERVER_URL: ${SERVER_DOMAIN}/api-baseball
         # MySQL
         MYSQL_DDL_AUTO: ${MYSQL_DDL_AUTO}
         BASEBALL_MYSQL_URL: ${BASEBALL_MYSQL_URL}
         MYSQL_USERNAME: ${MYSQL_USERNAME}
         BASEBALL_MYSQL_PASSWORD: ${BASEBALL_MYSQL_PASSWORD}
         # redis
         BASEBALL_REDIS_HOST: ${BASEBALL_REDIS_HOST}
         BASEBALL_REDIS_PORT: ${BASEBALL_REDIS_PORT}
         BASEBALL_REDIS_TIME: ${BASEBALL_REDIS_TIME}
         # rabbitMQ
         RABBITMQ_HOST: ${RABBITMQ_HOST}
         RABBITMQ_PORT: ${RABBITMQ_PORT}
         RABBITMQ_USERNAME: ${RABBITMQ_USERNAME}
         RABBITMQ_PASSWORD: ${RABBITMQ_PASSWORD}
         # YouTube API
         YOUTUBE_API_KEY: ${YOUTUBE_API_KEY}
         # AWS S3
         HO_AWS_ACCESS_KEY: ${HO_AWS_ACCESS_KEY}
         HO_AWS_SECRET_KEY: ${HO_AWS_SECRET_KEY}
         HO_AWS_S3_BUCKET: ${HO_AWS_S3_BUCKET}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-chat:
       image: backend-chat:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         # redis
         CHAT_REDIS_HOST: ${CHAT_REDIS_HOST}
         CHAT_REDIS_PORT: ${CHAT_REDIS_PORT}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-chatbot:
       image: backend-chatbot:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         # server
         CHATBOT_SERVER_URL: ${SERVER_DOMAIN}/api-chatbot
         # redis
         CHATBOT_REDIS_HOST: ${CHATBOT_REDIS_HOST}
         CHATBOT_REDIS_PORT: ${CHATBOT_REDIS_PORT}
         # OPENAI API KEY
         OPENAI_API_KEY: ${OPENAI_API_KEY}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-cardstore:
       image: backend-cardstore:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         # server
         CARDSTORE_SERVER_URL: ${SERVER_DOMAIN}/api-cardstore
         SERVER_PATH: ${SERVER_PATH}
         MILAGE_SERVER_DOMAIN: ${MILAGE_SERVER_DOMAIN}
         # swagger
         CARDSTORE_API_DOCS_PATH: ${CARDSTORE_API_DOCS_PATH}
         # rabbitmq
         RABBITMQ_HOST: ${RABBITMQ_HOST}
         RABBITMQ_PORT: ${RABBITMQ_PORT}
         RABBITMQ_USERNAME: ${RABBITMQ_USERNAME}
         RABBITMQ_PASSWORD: ${RABBITMQ_PASSWORD}
         RABBITMQ_PLAYER_QUEUE_NAME: ${RABBITMQ_PLAYER_QUEUE_NAME}
         RABBITMQ_PLAYER_ROUTING_KEY: ${RABBITMQ_PLAYER_ROUTING_KEY}
         RABBITMQ_MILEAGE_QUEUE_NAME: ${RABBITMQ_MILEAGE_QUEUE_NAME}
         RABBITMQ_MILEAGE_EXCHANGE_NAME: ${RABBITMQ_MILEAGE_EXCHANGE_NAME}
         RABBITMQ_MILEAGE_ROUTING_KEY: ${RABBITMQ_MILEAGE_ROUTING_KEY}
         # mongoDB
         MONGODB_USERNAME: ${MONGODB_USERNAME}
         CARDSTORE_MONGODB_HOST: ${CARDSTORE_MONGODB_HOST}
         CARDSTORE_MONGODB_PORT: ${CARDSTORE_MONGODB_PORT}
         CARDSTORE_MONGODB_DATABASE: ${CARDSTORE_MONGODB_DATABASE}
         CARDSTORE_MONGODB_PASSWORD: ${CARDSTORE_MONGODB_PASSWORD}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-board:
       image: backend-board:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         # server
         BOARD_SERVER_URL: ${SERVER_DOMAIN}/api-board
         # rabbitMQ
         RABBITMQ_HOST: ${RABBITMQ_HOST}
         RABBITMQ_PORT: ${RABBITMQ_PORT}
         RABBITMQ_USERNAME: ${RABBITMQ_USERNAME}
         RABBITMQ_PASSWORD: ${RABBITMQ_PASSWORD}
         RABBITMQ_BOARD_MILEAGE_QUEUE_NAME: ${RABBITMQ_BOARD_MILEAGE_QUEUE_NAME}
         RABBITMQ_MILEAGE_EXCHANGE_NAME: ${RABBITMQ_MILEAGE_EXCHANGE_NAME}
         RABBITMQ_BOARD_MILEAGE_ROUTING_KEY: ${RABBITMQ_BOARD_MILEAGE_ROUTING_KEY}
         RABBITMQ_AUTH_BOARD_QUEUE_NAME: ${RABBITMQ_AUTH_BOARD_QUEUE_NAME}
         RABBITMQ_AUTH_BOARD_ROUTING_KEY: ${RABBITMQ_AUTH_BOARD_ROUTING_KEY}
         # MySQL
         MYSQL_DDL_AUTO: ${MYSQL_DDL_AUTO}
         BOARD_MYSQL_URL: ${BOARD_MYSQL_URL}
         MYSQL_USERNAME: ${MYSQL_USERNAME}
         BOARD_MYSQL_PASSWORD: ${BOARD_MYSQL_PASSWORD}
         # AWS S3
         HA_AWS_ACCESS_KEY: ${HA_AWS_ACCESS_KEY}
         HA_AWS_SECRET_KEY: ${HA_AWS_SECRET_KEY}
         HA_AWS_S3_BUCKET: ${HA_AWS_S3_BUCKET}
         HA_AWS_REGION: ${HA_AWS_REGION}
         HA_AWS_BOARD_FOLDER: ${HA_AWS_BOARD_FOLDER}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-club-recommend:
       image: backend-club-recommend:latest
       restart: unless-stopped
       expose:
         - "8000"
       environment:
         TZ: Asia/Seoul
         ALLOWED_ORIGIN: ${SERVER_DOMAIN}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

     backend-mileage:
       image: backend-mileage:latest
       restart: unless-stopped
       environment:
         TZ: Asia/Seoul
         # rabbitmq
         RABBITMQ_HOST: ${RABBITMQ_HOST}
         RABBITMQ_PORT: ${RABBITMQ_PORT}
         RABBITMQ_USERNAME: ${RABBITMQ_USERNAME}
         RABBITMQ_PASSWORD: ${RABBITMQ_PASSWORD}
         RABBITMQ_MILEAGE_QUEUE_NAME: ${RABBITMQ_MILEAGE_QUEUE_NAME}
         RABBITMQ_BOARD_MILEAGE_QUEUE_NAME: ${RABBITMQ_BOARD_MILEAGE_QUEUE_NAME}
         RABBITMQ_MILEAGE_EXCHANGE_NAME: ${RABBITMQ_MILEAGE_EXCHANGE_NAME}
         RABBITMQ_MILEAGE_ROUTING_KEY: ${RABBITMQ_MILEAGE_ROUTING_KEY}
         RABBITMQ_BOARD_MILEAGE_ROUTING_KEY: ${RABBITMQ_BOARD_MILEAGE_ROUTING_KEY}
         # mongoDB
         MONGODB_USERNAME: ${MONGODB_USERNAME}
         MILEAGE_MONGODB_HOST: ${MILEAGE_MONGODB_HOST}
         MILEAGE_MONGODB_PORT: ${MILEAGE_MONGODB_PORT}
         MILEAGE_MONGODB_DATABASE: ${MILEAGE_MONGODB_DATABASE}
         MILEAGE_MONGODB_PASSWORD: ${MILEAGE_MONGODB_PASSWORD}
       logging:
         options:
           max-size: "10m"
           max-file: "1"

   volumes:
     jenkins_home:
   ```

2. React ë° publicìœ¼ë¡œ ì‹¤í–‰í•  Spring Bootì— ëŒ€í•´ì„œ Nginxì—ì„œ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

   ```sh
   cd ~/newbie/data/nginx
   vi nginx.conf
   ```

   <nginx.conf>

   ```conf
   user nginx;
   worker_processes 1;

   error_log /var/log/nginx/error.log warn;
   pid /var/run/nginx.pid;

   events {
      worker_connections 1024;
   }

   http {
      include /etc/nginx/mime.types;
      default_type application/octet-stream;

      log_format main '$remote_addr - $remote_user [$time_local] "$request"'
                     '$status $body_bytes_sent "$http_referer"'
                     '"$http_user_agent" "$http_x_forwarded_for"';

      access_log	/var/log/nginx/access.log main;

      sendfile on;
      keepalive_timeout 65;

      limit_req_zone $binary_remote_addr zone=mylimit:10m rate=1r/s;

      upstream jenkins {
         server jenkins:8080;
      }

      upstream backend-gateway {
         server backend-gateway:8080;
      }

      server {
         listen 80;

         server_name {DOMAIN NAME};
         server_tokens off;

         location /.well-known/acme-challenge/ {
         root /var/www/certbot;
         }

         location / {
               return 308 https://$host$request_uri;
         }
      }


      server {
         listen 443 ssl;

         server_name {DOMAIN NAME};
         server_tokens off;

         ssl_certificate /etc/letsencrypt/live/{DOMAIN NAME}/fullchain.pem;
         ssl_certificate_key /etc/letsencrypt/live/{DOMAIN NAME}/privkey.pem;

         include /etc/letsencrypt/options-ssl-nginx.conf;

         ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

         location / {
               limit_req zone=mylimit burst=1000 nodelay;

               proxy_pass http://frontend:3000;

               proxy_set_header Host $host;
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
               proxy_set_header X-Forwarded-Proto $scheme;

               add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
               add_header Pragma "no-cache";
               add_header Expires "0";

               add_header 'Access-Control-Allow-Origin' '*';
               add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS';
               add_header 'Access-Control-Allow-Headers' 'Origin, Content-Type, Accept, Authorization';
               add_header 'Access-Control-Allow-Credentials' 'true';
         }

         location /jenkins {
               proxy_pass http://jenkins/jenkins;

               proxy_set_header Host $host;
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
               proxy_set_header X-Forwarded-Proto $scheme;
               proxy_set_header X-Forwarded-Port 443;
         }

         location /api/v1 {
               proxy_pass http://backend-gateway;

               proxy_http_version 1.1;

               proxy_set_header Upgrade $http_upgrade;
               proxy_set_header Connection "Upgrade";
               proxy_set_header Host $host;
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
               proxy_set_header X-Forwarded-Proto $scheme;
               proxy_set_header X-Forwarded-Port 443;

               proxy_read_timeout 3600;
               proxy_send_timeout 3600;
               proxy_connect_timeout 3600;
         }
      }
   }
   ```

3. MongoDB Docker Containerë¥¼ ì‹¤í–‰í•œ í›„, wontouchì—ë§Œ ì ‘ê·¼ ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

MongoDB for Mypageë¥¼ ê¸°ì¤€ìœ¼ë¡œ Docker Imageë¥¼ ìƒì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.  
ë‹¤ë¥¸ MongoDBë„ ë™ì¼í•˜ê²Œ ì§„í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

**DATABSE**
Docker Container Name | Database Name
--- | ---
MongoDB for Mypage | mypage
MongoDB for Photo Card Store | cardstore
MongoDB for Mileage | mileage

```sh
# MongoDB Docker Container ìƒì„± ë° ì‹¤í–‰
docker-compose up -d mongodb

# MongoDB shell ì‹¤í–‰
docker-compose exec -it mongodb mongosh -u root -p

# MongoDB user ìƒì„±
test> use {DATABSE_NAME}
{DATABASE_NAME}> db.createUser({user: "{MONGODB USERNAME}", pwd: "{MONGODB PASSWORD}" roles: ["readWrite"]})

# user ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
{DATABASE_NAME}> db.getUsers()

{DATABASE_NAME}> exit
```

4. MySQL Docker Containerë¥¼ ìƒì„± ë° ì‹¤í–‰í•©ë‹ˆë‹¤.  
   (Spring Bootì˜ JPAë¥¼ í†µí•´ì„œ MySQLì˜ í…Œì´ë¸”ì„ ìƒì„±í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.)
   ```sh
   docker-compose up -d mysql-auth mysql-user mysql-baseball mysql-board
   ```
5. ê·¸ ì™¸ ë‚˜ë¨¸ì§€ Docker Containerë¥¼ ìƒì„± ë° ì‹¤í–‰í•©ë‹ˆë‹¤.
   ```sh
   docker-compose up -d nginx certbot jenkins frontend backend-gateway backend-auth backend-user backend-mypage backend-baseball backend-chat backend-chatbot backend-cardstore backend-board backend-club-recommend backend-mileage rabbitmq mongodb-mypage mongodb-cardstore mogodb-mileage redis-baseball redis-chat redis-chatbot
   ```
